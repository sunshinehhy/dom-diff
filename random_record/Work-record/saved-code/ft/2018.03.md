**2018.03.05**
ios用户11万多

从哪几方面跟踪？
每个设备每天访问量，每篇文章访问情况，页面访问量，

#### app performance
所有设备内容总点击和启动量   const totalOneLaunch = iphoneLaunches[i]+ipadLaunches[i]+androidLaunches[i];
每个设备内容的点击和启动量（是总得么？） extractDataFromGAAPI
每个内容设备的点击率，折合成整数值，不用百分数。 calculateRatesConvert

var iphoneClick = extractDataFromGAAPI(gaData1.reports[0].data.rows, keys);
keys为dimensions数组（统计天数dimension的数值组成的数组）
resultData[dimension] = metric;  为类似于resultData['20180219'] = 3066

extractDataFromGAAPI是返回metric值组成的数组。
画图需要值：
row.dimensions[0];
时间是14天
#### story recommend

向google analyse post查询数据

- Click Rates

- Seen and Click Counts

chartId = createChart();

drawCharts(responseDataArr);在function oneRequest() {}中调用

depend requestDataArr：TYPE Arr 用于存储数个ReportRequest对象,来自具体展示页面设置的全局常量。
depend responseDataArr： TYPE Arr 用于存储数个response.result对象，来自具体展示页面设置的全局常量。

function drawCharts(gaDataSource) {在main.js中直接调用的函数}

function constructQuerryData(startDate, endDate) {}会在main.js中调用
请求的值：
var VIEW_ID = '10995661';
// var startDate = '2017-04-27';
// var endDate = '2017-05-16';
var startDate = '7daysago';
var endDate = 'today';

 'name': 'ga:date'
 'expression': 'ga:pageviews'

 广告点击量
 第三方广告量

#### weekly-report.html
 function drawChartByKey(obj) {一个页面中需要执行多次，把它做成接口形式}

 怎么读取参数
 ```
 gapi.client.request({
      path: '/v4/reports:batchGet',
      root: 'https://analyticsreporting.googleapis.com/',
      method: 'POST',
      body: {
        reportRequests:requestDataArr[requestIndex]
      }
    }).then(function(response) {}
```
ios请求次数，ios分享数据，使用1个小时的用户，打开推送，注册人，app启动
比如：Screen Shot
action: "Request"
根据name值获取对应参数
根据想分析的数据设置相应参数，比如eventCategory

**2018.03.09**
iapActions('com.ft.ftchinese.mobile.subscription.standard.'+'new Date().getTime()', 'success', '');

        // case 'pending':
        //     if (productType === 'membership') {
        //         iapHTMLCode = '<a><button class="iap-move-left">订购...</button></a><p class="iap-teaser">' + productTeaser + ' ' + productPrice + '/年' + '</p>';
        //     } else {
                
        //     }
        //     updateProductStatus(productIndex, false, false);
        //     break;
    
测试只要fail，就一直fail，actionType没有复原值

    // if (iapButtons.length>0){
        // iapButtons[productIndex].innerHTML = iapHTMLCode;
        // console.log('iapButtons:'+iapButtons.length);
    // }else{
    //     console.log('iapButtons length is 0:');
    // }

    // Mark: Update iap Button at the bottom of the detail view
    // if (productID !== '' && document.getElementById('iap-rail').getAttribute('data-id') === productID && gNowView.indexOf('storyview') >= 0) {
    //     document.getElementById('iap-rail').innerHTML = iapRailHTML;
    // }

**2018.03.12**

<div class="policy"><a href="http://www.ftchinese.com/m/corp/privacy-policy.html?ad=no">'+services[0]+'<span>></span></a></div>

代码记录：
gStartPageStorage = localStorage.getItem(gHomePageStorageKey) || '';
        _localStorage=1;

function loadStoryData(data) {
    data可以从localstorage中读取
}

new Image().src = 'http://m.ftchinese.com/track/ga.php?utmac=MO-1608715-1&utmn=2013101610&utmr=-&utmp=%2Fphone%2Ferror%2FlocalStorage&guid=ON';
这句话什么意思？没有指定image啊

function freezeCheck() {
    .fixed-content 是日历（时间选择）和十大热门文章
}

十大热门文章：$.get(gHotStory + themi   请求出来的
function getvalue(thekey) {
    从localStorage和cookie中获取。  thekey是什么值？
}

coveranchor:home内容
function removehttps(data) {
    return data.replace(/https:[\/\\]+api.ftmailbox.com[\/\\]+media[\/\\]+/g, 'http://i.ftimg.net/');
}
图片域名替换成http

ipadstorage？

追踪错误和追踪失败

**localStorage：**
主页
1. actionTimeStamp
2. actionUrl   /phone/channelpage/index.php/ft/channel/phonetemplate.html?channel=myftsetup
3. homePage   html代码
story
iOSShareWechat
offlinePageView
homePage
4. 字体大小设置

**代码记录**
<!--channel view start-->
id="channelview"channelview

ft-icon-back-arrow:返回图片

<div id="remindBack" onclick="histback()"><span class="ft-icon-back-arrow ft-icon"></span>&nbsp;点击文章左侧回退</div>   这是在哪里？

**应用正则表达式的地方：**
- 检验url
theurl = theurl.replace(/[0-9\=\?\&]+$/,''); 
- 解码url
//界面操作
function getURLParameter(url, name) {
  return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(url)||[undefined,''])[1].replace(/\+/g, '%20'))||null;
}
**channel url：**
http://m.corp.ftchinese.com/androidapp.html#/channel//index.php/ft/channel/phonetemplate.html?channel=management

http://m.corp.ftchinese.com/androidapp.html#/channel//index.php/ft/search/?keys=%E4%BA%9A%E6%B4%B2&type=default&i=2  （搜索链接）

showchannel(url, keys);中的值一直根据url和keys跟新

搜索的值也会保存在localstorage中，搜索中的值不仅能搜索出框中的，也会有搜索下面的值。

//MARK: - 每次打开的时候都取新的链接，每分钟更新一次参数以减轻服务器压力
首页和专栏页面都是请求出来的html页面，然后直接放入html中

点击页面翻页数（频道分页）：href

设置字体大小：会滚动，调用函数function reflowscroller() {}
滚动的时候，广告会更新

点击首页：触发backhome()动作
function switchNavOverlay(actionType) {打开导航，页面左上角三横
    turnonOverlay('navOverlay');  //打开Overlay
    addnavScroller('navList');  //增加List
}

myFT()函数是我的FT触发

设置通知在帮助里

触发这js代码是在html中么？
有什么办法解决这个返回么？
需要有个请求，showchannel(regFormUrl, '新用户注册');

var gHomePageStorageKey = 'homePage';
var gNewStoryStorageKey = 'homepage';

id="homeload"：什么时候出版，也就是首页面nav下面第一行。

$('#homecontent').html(data);首页
id="storyview"  story页

requests.push($.ajax({}））

点击channel，body中类名fullbody变为channelview ，
id="channelview"
id="storyview"
id="fullbody"

点击channel中某一个，会调用readstory(storyid);

**2018.03.13**
代码记录：

返回按钮触发此函数：function histback(gesture) {

}
记录首页、story和channel页面history
window.history.pushState(null, null, gAppRoot + theurl);  

根据hist，记录的url，返回对应的url，并且请求这个地址信息，假如缓存中存在取缓存地址，假如不存在，向后台请求。
根据hist中保存的url，用pushState和replaceState更新页面。

**2018.03.23**
item-container XL4 L4 S12 M6 P12     has-image  3列

<%assign var="listHasFloat" value="`$list.float`"%>

<%assign var="prev" value=$l-1%>

<%if $list.feedType == "myFT"%>

  <%if $smarty.get.newnav == 'yes' %>
    <%php%>
    $filename = "../frontend/tpl/next/api/page/navCopy.json";
    $handle = fopen($filename, "r");
    $json = fread($handle, filesize ($filename));
    fclose($handle);
    $page = json_decode($json, true);
    $this->assign("p", $page);
    <%/php%>
  <%else%>
    <%php%>
    $filename = "../frontend/tpl/next/api/page/nav.json";
    $handle = fopen($filename, "r");
    $json = fread($handle, filesize ($filename));
    fclose($handle);
    $page = json_decode($json, true);
    $this->assign("p", $page);
    <%/php%>
  <%/if%>

  ($itemType == "interactive" && preg_match("/推广视频|精彩视频|产品视频/is",$item.tag))%>
<div class="image">
    <figure class="loading-video" data-vid="<%$itemId%>" data-item-type="<%$itemType%>"></figure>
</div>

学习到：

公司服务器会强制走缓存，有时候会覆盖cookie中缓存，所以获取到的cookie不可靠。
所以强制清楚缓存，再获取浏览器缓存。
设置缓存时间为1分钟。


https://tagmanager.google.com
http://ratwu.com/2013/05/google-tag-manager/
http://www.itamt.com/tag/google-tag-manager/
Tag Manager 产品（http://www.google.com/tagmanager/），适用于站点多，运行多套：流量，广告系统的用户。部署一份脚本，然后根据规则，加载对应的脚本，方便修改和管理，还支持版本和调试等功能。中文帮助在这儿：
http://support.google.com/tagmanager/?hl=zh-Hans，国外的话，之前也有很多类似的商业产品。
- 使用跟踪代码管理器，就无需再在源代码中维护每个代码段，而只需在跟踪代码管理器界面中指定您希望触发的代码，以及您希望触发的时间。
- Google 跟踪代码管理器中使用的大多数代码的作用是将您网站中的信息发送到第三方。
- 如果把信息发送到多个第三方，如果不使用gtm，需要嵌入多个代码，假如使用的话，仅仅引入gtm的代码
- 最佳做法是将变量设置为直接从结构清晰的数据层对象检索信息，而不是从 JavaScript 变量或 DOM 进行检索。
- 容器代码段跟数据层放置顺序有关
- AMP 是 Accelerated Mobile Pages（加速移动网页）的英文缩写。AMP 是一种制作可快速加载的轻量型网页的方法，特别适合于移动设备。跟踪代码管理器支持 AMP 容器（类似于标准网站容器）。
https://developers.google.com/tag-manager/devguide#datalayer
WASP
谷歌Tag Manager (GTM)是一种新技术，允许营销人员管理他们自己的分析、用户跟踪、活动跟踪、再营销和其他网站代码。Tag Manager将营销人员从依赖IT或web开发部门中解放出来;当管理员想要添加或修改一个分析或跟踪代码片段时，他们可以自己动手，将其添加到现有的标签容器中。

https://jingyan.baidu.com/album/54b6b9c09141262d583b47b0.html?picindex=1


##
可以将自己要监测的该网站上的所有代码推送至该容器。
粘贴进所有需要监测的页面的<body>标签后面。

首先是`确认已经部署在网站中的所有代码及其部署位置`（例如所有页眉或页脚、着陆页、确认页以及对按钮点击的响应等）。

`仔细思考您想要收集的信息并决定是否要部署其他代码。`如果您要收集的数据没有在网页上显示，请参阅开发者文档，了解如何将其他数据传递到代码。

如果您的所有代码都会在网页加载时触发，而且可以通过网址识别这些网页，那么基本的容器实现就可以满足您的需求了。

##

注意:为了使培训尽可能的通用，我们使用了非移动版本的GTM，并为一个通用的WordPress站点配置它。您的具体实现将取决于您的站点是如何编码的。
主题包括:
创建帐户和容器。
安装容器
使用来自分析、ClickTale和其他服务的内置标签。
使用变量
发射事件和触发器
创建版本
使用自定义标签
实现数据层

###Installing a container on WordPress (CMS)

到目前为止，还不错，但是这段代码真的在运行吗?我们可以做的一件事是用WASP这样的工具检查是否有任何东西被加载到这里。我们会在后面的课程中详细介绍WASP Chrome扩展，在这里并不是很必要，但它对验证很有帮助，所以如果你希望你可以通过在Chrome Store上搜索WASP来下载它。

我不需要每一页都这么做。它是一个模板，它会在每个页面上为我重复它，只要我包括这个header。php。好的，我要保存这个。现在，如果我回到网站本身，我可以打开这里的任何一页，我应该确保我看到那里的标签管理器。是的，就在这里，就在打开的身体标签下面。很容易安装，现在它的好处是在默认header。php的每个页面上。

有一件事，我们还没有谈到数据层的自定义维度，但如果你要特别关注这个视频，在WordPress和谷歌分析上寻找帮助，在谷歌标签管理器上运行，我想让一件事清楚。所以，请允许我稍微领先一步。因为这个谷歌标记管理器代码将在WordPress循环之前运行。这是WordPress内的一个特殊功能，它可以加载所有的信息。现在，一些特定于这个帖子的东西，比如作者的名字，现在还不能使用，因为这个标签管理器代码实际上会在循环开始之前运行。

所以，如果你想要发送数据，比如，作者名，或者关于post本身的东西，到数据层，或者谷歌分析作为一个自定义维度，你有几个选项。首先，您可以在循环运行后设置数据层或自定义维度变量。现在，当然，由于主要的谷歌分析页面视图数据会被发送，您将不得不触发另一个页面视图，或者一个事件，以便将自定义维度数据返回到谷歌。我建议一个事件，作为一个非交互的打击。因此，通过向单个页面发送多个页面视图，这样就不会提高您的跳出率，或者您的页面视图计数。

现在，你的第二个选择，是利用一个插件，它将允许你直接与WordPress集成，并自动获取我们讨论过的许多常见变量，比如，作者。现在，如果我回到WordPress编辑器，我在这里，如果你在寻找插件，我们来到这里的插件，我们可以添加新的。做一个搜索。现在，你会在这里看到一些可能符合你的需求的东西。我不能特别推荐，或者担保这些，你会想要仔细检查它们是否与你正在运行的谷歌标签管理器的版本是有效的，但是它们可能是你有时间问题的选项，特别是在循环中。

好的，我们在这里做的是，我们使用了CMS的一个特性，所以我们可以一次粘贴容器代码，并让它自动出现在所有页面的正确位置。



大多数tag managers的优点之一,包括谷歌,是它们能简化部署标签的过程，通过模板和内置的交钥匙标签,你只需输入你的信息,比如一个帐户号码和它的heavylifting你的语法和其他细节。虽然谷歌标签管理器可以部署任何类型的标签，但众所周知，到目前为止最流行的标签是谷歌自己的分析软件。这是有意义的，因为尽管它的基本配置很简单，但是一个相当复杂的谷歌分析标签很快就会变得非常复杂。

因此，我们将在本视频中查看谷歌分析标签，它将作为内置标签的一个示例，并希望帮助您解决您最迫切的标签管理器需求。我们还将在其他视频中重新讨论这个谷歌分析标签，因为我们添加了复杂性，比如触发器、变量，甚至是数据层。之前，我们安装了我们的容器，并没有做任何其他事情。没有标签，没有触发器，没有变量。因此，让我们利用这个机会发布我们的第一个标签到这个网站。你可以来这里，点击新标签。我们将选择谷歌分析内置的基本标签。

在这种情况下，我们需要 Universal Analytics。现在我们来触发，我们要选择All Pages。例如，我们可以使用一些页面来进行电子商务交易。这所有的页面都是一个内置的触发器，如果我们想要更具体一些，只在那些需要 thankyou.php页面上说。在URL中，我们需要在这个点建立一个触发器，但这将是后面的视频。现在，我们要在所有页面中设置我们想要的基本标签，所以我们要选择这个，然后点击Continue。现在，我们要在这里配置 Universal Analytics标签的细节。

<p>在本例中，我将给它一个标签名，不管你想要什么。您可以有自己的命名约定。我有我自己的。我喜欢用数字来开头，这样我就能让它们井然有序，更有条理。我们将它命名为GA基础标签因为我们会有电子商务标签和事件标签和其他的，但这将是每个页面上的基本标签。接下来我们需要的是谷歌分析跟踪ID，如果你不熟悉的话，我们可以从他们给我们的脚本中找到这个代码。来到我们的谷歌分析账户，点击Admin，来到这里Tracking info，选择Tracking Code，我们要找的是这个以UA开始的数字。</p>

这是我们的账号，有时被称为我们的UA号码，有时被称为财产。如果我现在能抓住它。它们会自动为你高亮显示，这有点棘手。我们想把它复制到这里。回到这里，我们从UA开始粘贴。确保我们没有抓住任何撇号或其他东西。下一个问题是我们是否要启用显示广告功能。对于那些利用DoubleClick在谷歌分析数据如人口统计报告,所以年龄和性别和兴趣和亲和力或营销AdWords和DoubleClick,你想检查这个盒子,它会自动调整标签包括这一部分,使调回DoubleClick。

我们会继续做这个来展示它是如何工作的。因为这是基本标签，所以我们要把它放在页面视图上。这是我们将数据发送回谷歌的方式，每次页面加载时都会出现一个页面视图。稍后我们将讨论一些其他选项，例如事件，但现在我们只想将其作为返回的主页面视图。对于简单的基本标签，就是这样。让我们来完成这个，确保它能正常工作。单击Create标签。好的，现在让我们浏览一下这个网站。我们之前说过，这里有Tag Manager。

所以我们刷新了这个页面，我应该看到一些调用谷歌分析。现在，在我们创建标签的时候，希望你们当中的这个家伙发现了这个，我们没有发布它。您必须发布新的版本容器以使其能够正常运行。所以我们回到这里，果然，我们看到了一个未发布的变化。我们可以继续，点击红色按钮来发布，它会发布那个标签。现在发布。只需要几秒钟。如果我们回到这里，刷新这个，当然，现在我们看到一个来自google-analytics.com的电话收集脚本。

再检查一下以确保…是的，这里有合适的UA号码。你可以在这里看到。我们还可以看到，当我们谈到启用显示广告功能时，我们会回到DoubleClick。That's what this second call's about。对于那些不使用WASP的人，我们还可以通过网络来检查这个。我们可以一直搜索分析，我们会看到analytics.js加载和收集回调到Google servers。

好了，现在我们已经发布了第一个工作标签我们将数据发送回谷歌。对你们中的一些人来说，可能就是这样。如果你只安装了一个普通的谷歌分析，没有任何事件或电子商务，那么你现在就在跟踪你的网站。但是Google Tag Manager可以做的不仅仅是谷歌分析，所以我们将在下个视频中看到一些其他的标签。

###ClickTale and other built-in tags

当我们在新闻标签部分看到这些预先构建的标签时，我们看到有许多非谷歌分析相关的标签。毫不奇怪，谷歌也有许多其他的标签，比如谷歌Adwords用于营销和转换跟踪标签。这两种方法都可以将受众作为我们营销列表的一部分直接添加到AdWords或信号AdWords中，而无需直接链接到谷歌分析。双击客户端可以从这里触发泛光灯标签。现在我应该指出，在这段录音的时候，美国客户不能使用在tag manager中发现的谷歌可信存储模板，但是在英国、法国、德国、澳大利亚或日本的客户可以使用它将这些标记代码添加到他们的站点。

正如你所看到的，各种各样的标签都是内置的，有些甚至直接与谷歌竞争。这里还有其他的营销标签，比如艾薇儿。有显示广告跟踪标签，如Mediaplex。有一些搜索竞价的经理，比如Marin。有观众跟踪，比如广告顾问，bizo, comScore，酒厂和VisualDNA。这里还有一些分析工具，有clicktale和comscore。现在，clicktale是我们的几个客户使用的。让我们再来看看这些预先构建的标签能有多快的例子。来这里，我们选择clicktale作为我们的标签。

现在，我们可以在一些页面或所有页面上触发它。在我们的例子中，我们将使用所有的页面。稍后我们将讨论一些触发点，并深入到其他的触发点。但是，为了这个标签，我们会说所有的页面。我们可以任意命名它。我们可以把它叫做clicktale标准跟踪或基本标签或者在这里放一个编号系统，不管对你有什么作用，我们都按原样离开。你会把你的项目ID放在那里。在我们的例子中，这是。然后是样本速率。实际上，采样率是很有趣的。

有一种方法，如果你想减少你的成本，你想把多少数据发送回clicktale，你可以调整你的采样率。现在，在这种情况下，这是一个内置到clicktales标签的东西。他们知道这是什么。但是，如果你想手动调整这个，你可以做的一件事就是到这里来，说一些东西，只在一个已发布的容器中发射这个标签。这样，当你做任何类型的负载测试时，如果你在做任何调试，你就不会把数据发送回来，这会花掉你的钱。所以，如果你有特别贵的标签，你可以检查一下那个盒子。对我们来说，我们要把采样率设为1以确保它确实触发了，然后他们给我们的分区是这个。

好的，我们要创建这个标签然后进入页面。来到这，重新载入我们的页面。好了，我要按下F12来把控制台面板拿回来。我可以检查网络，或者直接进入wasp，可以重载它，但我没看到。是的，我们忘记发表了。我很不情愿地为这些提醒的发布道歉，但是这是我看到的第一个问题，而且这是一个很容易忘记的步骤。

所以，我认为这值得提醒，并且要经历一些你可能犯的错误。我们当然会回到这里，继续发布。我们有一个标签更改，1个未发布的更改。成功，成功，已经出版了。所以，现在当我回到这里刷新这个，我希望看到，它是，clicktale一个刚刚出去，我们看到点击器脚本在那里运行。这就是如何利用内置标签模板的方法。除非你有一些特殊的配置原因，否则这些方法是行不通的，这是可能的，但除非你这样做，否则我强烈建议你尽可能利用交钥匙标签。

部署的时间不仅要快得多，而且您可能会有更少的错误，因为所有繁重的任务和语法都是为您完成的。现在谷歌继续增加了这些集成。所以，当你看到这个视频的时候，可能会有更多。

###Understanding basic variables

到目前为止，我们已经了解了如何部署内置的标记，对于一些人来说，这将足以让您使用谷歌分析、谷歌AdWords等等。但是，当您利用它作为标记的中央管理系统的能力时，tag manager中的实际权力就出现了。其中的关键之一就是能够做一次事情，并在多个标记之间使用它。变量是一种方法。就像程序员可以设置一个变量，然后从多个函数调用它，我们可以在Tag Manager中设置一个变量，然后在需要的地方使用它。变量只是一个名称-值对，这意味着我们给它一个名称，然后我们设置一个值。

例如，假设您正在为一个新站点设置谷歌分析标记，并且许多组织选择拥有用于测试和开发的Web属性，这样他们就不会用测试数据、负载测试之类的方式填充他们的生产报告。现在，对于谷歌分析，你有一个基本的标签，但是你可能会包括电子商务跟踪标签，表单跟踪标签，事件标签，以及其他几种变化。每个标签都需要知道你将数据发送到哪个帐户。如果你硬编码每一个数字，就像我们在前面的例子中所做的那样，那么你每次都必须输入那个数字，并且确保你在任何时候都不会犯错误。

但是在我们的例子中，我们想要使用这个测试属性然后切换到生产，他们需要进入并重新硬编码每一个标签。一个更简单的方法是简单地用帐户ID设置变量，然后在每个标记中使用该变量。这样的话，如果你想改变它，比如当你去生活的时候，你只需要在一个地方改变它，你就可以确信它在任何地方都得到了更新，并且得到了正确的数字。现在，这是我们从零开始创建的一个变量的示例，但是谷歌标记管理器还包含了几个更通用的变量。

例如，当前的URL作为一个变量可用，如果您试图设置一个过滤器，只在某些URL字符串匹配时只触发一个标记，这将非常有用。也许你在寻找一个在名字中有“谢谢”的东西，所以我们可以看到URL中的值，与“谢谢”相匹配，这时我们就可以把标签设置为fire。现在，如果你看这两个，第一个例子是一个变量我们给出了一个常数。这个数，本质上是不会改变的。即使你可能改变它从我的账户到你的,或者我重新开发的价值,我们搬出去,投入生产,在大多数情况下它会保持不变,它不会改变每一个页面,或从参观访问,或人。

但是第二个，那个URL，是一个变量的例子，当你在这个网站上移动时，它会更新。该变量的值将不同于每个页面视图和访问该站点的每个人，因为它反映了当时那个访问者的当前页面。这是自动记录和更新标签管理器,但是我们也可以利用一个动态值,改变整个访问,对于每个人,就像我们在这里做的URL,但我们甚至可以做当它不是由浏览器自动更新。最常见的例子之一是购物车中的交易总额。

如果你回想起之前的视频，两个内置标签是谷歌AdWords转换标签和谷歌分析标签。现在，在这两种情况下，能够发送回数据都是非常有价值的，不仅仅是签出发生的事实，而是因为签出的值是多少。现在，浏览器不会自己知道这个信息，这个信息必须由购物车软件提供，很可能是在收据或感谢页面上。现在，我们可以使用这个值来填充我们创建的这个变量，比如说，TransactionTotal，然后我们可以将它包含在标签中，包括这个数量。

现在，变量对于那些希望将访问者页面视图返回到Web分析或其他跟踪系统的人来说也是非常有用的。例如，那些使用我的谷歌分析技巧和技巧课程的人将会熟悉一个案例，在这个案例中，一个查看者在询问如何能够捕获用户的本地时区。你看，问题是谷歌分析允许一个可定制的时区，但它对所有用户来说都是相同的时区，可能是我的时区。例如，如果你运行一个社交媒体网站，你想看看人们早上醒来，用手机登录，你需要在用户的时区进行分析，而不是分析你的分析师时区。

因此，我们可以从浏览器中获取时间，我们可以把它保存在标签管理器中作为变量，然后我们可以使用它来定制维度或者其他任何我们想要包含这些数据的地方。好的，这是你可以使用变量的类型和方法的一小部分，但是它让你知道它们是什么以及你为什么要使用它们。在下一集视频中，我们将展示如何实现这些示例。

###Understanding the data-layer concept

我应该说，我们可以在数据层上做一个完整的课程，也许有一天我们会。所以我们不会涵盖所有的知识，以及你可以使用它的各种各样的方法。我们的目标仅仅是让您了解它是什么，为什么它有用，以及一些基本的方法来开始使用它。在我们开始讨论JavaScript之前，我们先来做一个类比。我的一位同事戴夫·芬尼克(Dave Finnick)有一个我非常喜欢的餐馆模型，它展示了数据层的效率优势。这是一个表示一个标准的自助餐厅,当客户决定他们想要一些面条和一些汤,他们不回到厨房,从头开始煮汤,面食,厨师准备食物在一个盘,他们把它放在自助餐,无论客户感兴趣的这道菜,可以利用。

你可以进一步类推。如果这是一个非自助餐的例子，侍者或服务员也是如此。当顾客点了汤时，服务员就不回去了，开始拿出配料来开始汤。这样做不仅效率非常低，而且服务器还必须了解他们在厨师工作中的工作。而且，如果厨房里发生了什么变化，也许切肉刀会移到另一个抽屉里，现在，只有厨师需要知道这一点。他们不需要每次都去重新培训每个服务器甚至所有的客户。就这一点而言，厨师不会只做一份沙拉酱或汤。

有一个公共的池，它被提供给任何一个客户订单，并且它是按需要访问的。好了，这就是餐厅模式，让我们回到我们的网站。首先，你还记得我们讨论过的这个旧模型所有的标签都只是在页面上散布然后代码收集数据被硬编码到表单中等等。这可能是最糟糕的情况。但是让我们稍微抽象一下，想想，数据需要从哪里开始呢?现在我们想一下，页面上有事件。因此，出现了一个页面视图，然后我们讨论了Vase Type Changed和 the radio buttons。

也许一个表单字段被填满了，我们有一个购物车交易给了我们一个感谢页面。现在的问题是，这些数据需要去哪里?也许我们有一些营销自动化标签可以帮助我们理解营销和电子邮件是如何运作的。我们有AdWords转换跟踪，它告诉我们我们的一些广告是怎么做的。您可能有一些Clickstream分析，比如谷歌分析和表单优化，比如ClickTale。有各种各样不同的数据收集标签和供应商我们可以使用它们的每一个。有些人想知道某些事情。你会想到一个页面视图，营销自动化可能会想要知道，特别是当它是一个登陆页面时。

由于我们的Adwords转换跟踪，他们特别想知道，它是一个感谢页或一些转换页面。现在，但是Vase Type Radio Changed，还有一个点击流分析（a Clickstream Analytics ）可能想知道作为一个事件，我们的表单优化想要知道，因为这是优化的，人们使用表单，而那些单选按钮是表单的一部分。当然，表单字段的启动将是表单优化的一部分。也许我们会把这些数据发送给我们的Clickstream分析，也许不是，但是你知道，也许。营销自动化可能想要知道，表单正在被再次交互，特别是如果它是系统的一部分。

我们甚至可以把它作为一个Adwords转换跟踪成功，人们开始填写这张表格。也许不是，你永远不知道，但它是这个矩阵的所有部分，数据可能会，也可能不会。现在，购物车交易是很重要的事件，很多人都想知道。营销自动化的人们可能特别想知道，不仅仅是它发生了，而是围绕它的更多细节。AdWords转换跟踪肯定会想要知道一些类似的东西。Clickstream分析想要了解很多关于这方面的东西，可能是关于它的全部细节，产品，sku或者是什么。

即使是形式优化的人也想知道这一点。正如你所看到的，在很多情况下有很多不同的数据需要去很多不同的地方。现在，很大程度上，这是我们开始用Google Tag Manager安装的东西。但是，这也应该是与供应商无关的，我们可能有谷歌标签管理器，它涵盖了一些工具，但不是全部。当你在做过渡和现实的时候，当你有很多很多的标签的时候，你会发现，有些东西会被标签管理系统所覆盖，其中一些会在系统之外。

这里的想法是，我们想要试着去理解事情的发展方向，不管供应商是什么。我们不想锁定一个私有系统本身。好的，希望这是显而易见的，我们回想一下整个页面的自助餐例子。这是中间的数据层。这个数据层将会是一个普通的数据自助餐表。该网站将把数据和事件发布到数据层，供应商将以标准化的格式从那里获取数据。但是我想让这个例子更加真实，因为这个格式的问题是一个非平凡的问题。

在您收集购物车事务的信息之前，购物车必须在您的网站上存在。这也意味着，在你的站点上安装之前，必须有人把它编码，特别是如果你的it团队购买了一些现成的软件。所以，想想那些正在创建购物车的程序员。即使他们知道购物车交易结果对每个人是真正重要的事情，都从网络广告性能工具分析、内容优化休息平台,但他们是怎样得到信息,当他们不得不编写购物车之前他们甚至知道客户是谁,更别说它网站上,更不用说这供应商将寻找数据?让我们看看他们的选择。

也许只是后台数据库，你的记录系统接收数据，知道交易中发生的事情。我认为这是最坏的情况。也许他们会在屏幕上显示，在一个收据页面的某个地方，在那里你会得到一个…结帐总数是这个和这个,你有这些项目,你可以在某种程度上刮HTML的屏幕,这是一个真的问题,因为如果有什么变化,格式化或者在页面上,然后屏幕刮刀会各种各样的麻烦。

也许我们假设每个人都使用Adobe或谷歌分析或IBM，我们也用硬编码。我们说，“给我你的UA号码”，你的帐号和我将负责其余的。当然，这给了我们几乎没有灵活性，你不能发送你想要的定制尺寸，你不能发送你的事件，当你想要移动到像通用分析这样的东西时，你没有太多的灵活性。所以，即使他们有合适的供应商，他们是否会保持标签更新?不幸的是，这是一个很常见的问题，但它的灵活性非常有限。

也许你可以用自己的专有格式存储它。就像我们在这里做的那样，我们说有一个叫做Cart Total  JavaScript变量，这是这个特定的供应商如何定义的，我们将会期望谷歌分析的所有人来找出并调整它，然后我们会有一些翻译。或者，我们可以将其存储在一个公共数据层上，该层对所有供应商开放，并使用标准化格式。希望你们会同意这是目前为止最好的案例我们希望在网络分析世界中人们会开始标准化这个数据层我们不需要做所有的翻译。

这是迄今为止最好的方法。希望这个类比是清楚的。我们有消费的实体，顾客和餐馆，标签和网站，以及提供东西的实体，厨师和网站事件以及网站本身的数据。我们想要尽可能高效地移动它们，数据层就是这样做的。我将强调它与谷歌标记管理器非常有效，但是它可以与站点的任何部分一起使用，任何供应商。现在谷歌标记管理器使用，甚至可以创建数据层。

但是数据层不是谷歌标记管理器的一部分。它在外面，它是供任何人和每个人使用的。这与谷歌标签管理器使用HTML的方式类似，而且它可以使用JavaScript，但这些并不仅限于谷歌标签管理器，而且数据层也不是。既然我们已经知道了什么是数据层，以及为什么它应该在很久以前就出现在这里了，在接下来的video中，我们将看看如何创建和使用一个。

###Populating data layers via push

我们之前看到了数据层是什么，为什么你想要一个。现在我们来讨论一下如何创建它，也许更重要的是，如何填充它。当然，你所填写的数据完全取决于你自己，但是有一些更常见的例子可以让你了解你的选择。对于收集到的关于访问者的信息，您可能对用户类型之类的东西感兴趣。例如，航空公司的内容管理系统可能会使登录用户的频繁飞行状态成为可能。这在分析中非常有用。CustomerID只要不包含个人可识别信息，也很常见。

除了LoggedInStates、region等，现在要记住，像区域这样的数据通常是由像谷歌分析这样的系统来计算的。但是由于数据层是许多供应商的所有标签共享数据的公共场所，所以一定会有一些重叠。通过发送这些数据，即使它已经被谷歌分析复制，它也确保了数据和格式的一致性。例如，谷歌分析有它自己的计算区域的方法，也许，你想用你自己的，比如你的内部销售区域。

也许是AMIA，也许是J PACK，那种东西。关于页面和会话的信息更常见，例如，在大多数内容管理系统中，特别是在博客中，有一个页面作者的概念，通常是一个类别。现在我要指出的是，数据层目前仅限于一个页面级别的对象，这意味着每次加载页面时，都会得到一个全新的新数据层。如果你想跟踪对象的会话水平,事情保持等页面,页面的总数看到迄今为止在会话中,你必须确保你跟踪那些增量,推动每个页面加载。

同样重要的是指出数据层不只是静态的constance，它也在那里跟踪事件和这些事件的状态。这对于具有像旋转木马或AJAX内容的动态页面来说尤其重要。页面加载将会发生一次，但是我们可能希望将所有交互作为一个页面更改进行跟踪，而数据层事件是一个很好的方法。现在值得指出的是，我们讨论的这些数据层事件与谷歌分析事件是不一样的。当数据层事件发生时，您可能会使用它作为触发谷歌分析事件的触发器，但除此之外，它们之间完全没有任何关系。

这是因为数据层是一个通用的供应商无关的元素，它属于网站的一个页面，而不是谷歌分析，甚至谷歌标签管理器，或者任何供应商。好的，说到事件，在数据层中有三个事件谷歌标记管理器会自动推送到数据层来跟踪状态，并确保在正确的时间发生火灾。第一个是gtm.j。当谷歌标记管理器被初始化时，它就会被推送到数据层，所以在这个过程中很早就开始了。

如果您想要尽早标记，您可以在事件等于gtm.j时设置触发器。但是，更常见的情况是，我们想要标记等待，直到页面上发生了其他事情，所以下一个事件是gtm.dom。现在dom是文档对象模型。这基本上就是页面在浏览器中的结构。这gtm。dom事件意味着所有已排队的请求现在都已被执行。最后一个事件是gtm.load。这意味着不仅定义了结构并执行了队列，而且整个页面上的所有图像、脚本和其他资产最终都完成了加载。

大多数时候，我不建议您设置重要的标记等待gtm。加载是因为，只有一个错误的脚本或缓慢的加载图像会导致你的整个标签坐下来，由于超时，它可能永远不会加载。除了这些默认事件，我们还可以看到诸如点击事件这些是我们触发的类型，例如，如果你记得这个花瓶，每次我们改变单选按钮，我们就会得到一个点击事件。我们有各种其他的事件可以添加，特别是在我们开始与页面交互之后，但是这些都是内置的，这些将会加载每一次谷歌标记管理器初始化的时间。

我们已经看到了静态数据，比如我们可以添加的页面作者名以及可以添加的事件的概念。让我们看看如何实现这个目标。首先我们要初始化，我们有两个选项。如果我们只留下足够的内容，谷歌标记管理器代码片段将为我们完成。问题是，如果我们想要将元素添加到页面的数据层中，比如它们可以被谷歌标记管理器使用，然后我们需要在更早的时候初始化它。现在，我们可以简单地将代码放到谷歌标记管理器代码段之前，通常在head标签中。

这是一条简单的JavaScript代码，放在这里。我们有一个打开的脚本标签和一行，dataLayer等于和这些空括号，然后是结束脚本。它简单地声明一个数组并调用它dataLayer。注意，你必须遵循这个命名，小d，大L，因为这正是GTM在默认情况下要找的。声明很简单，但是它本身就没什么用。我们需要得到数据，在第一张幻灯片上，我们会做谷歌的推荐。这没问题，但由于某些原因，它并不理想，我一会儿会解释，现在它会和以前一样，只是在初始化它时，除了那些空方括号外，我在这里放了两行信息。

我们在这里使用的花店在全国各地有不同的花卉供应和风格。我这里有菜单样式它会捕捉显示的菜单我们会设置菜单的geo显示。我们之前的版本的问题是，虽然从技术上讲是正确的，但我看到了新来者经常犯的两个错误，它们是灾难性的。第一个，你们会看到，是他们在这里运行谷歌标签管理器片段然后他们去填充dataLayer，就像我们之前看到的那样。但这里我们实际上是在重新声明，它将清除GTM使用的那个。

你不想再次声明它，在你已经这样做了之后，这是不好的。第二个问题是，当您向数据层添加更多的项时，您将再次使用相同的初始化脚本，然后将以前的数据层吹走，然后用一个新的数据层替换它。这里我们有我们第一次初始化它,我们把menu-style放在这里,然后这些点这些椭圆代表更多的代码,然后以后我们说,嘿,想添加菜单后面,所以我们做的是相同的代码,会发生什么我们重新定义它,失去之前我们所做的一切。

这很容易做到，因为你只是在剪切和粘贴，但是就像我说的，调试起来会很困难，而且会导致重大问题。所以，我喜欢做的更好的方法是在页面顶部声明dataLayer一次。如果你想变得更花哨，你甚至可以检查它是否已经在你做之前已经声明了。但是，我们不会做得太深入，只要你只做一次，大多数人认为这是可以管理的。之后,你会填满数据使用这个推函数,在这种情况下,我有一些其他的代码,然后回来,我将更多的项目没有问题,因为我不是重新声明,我只是促使更多的项目现有的数据层。

我已经做了这个例子，让我们进入界面，看一下。你看这里，我有我的标签管理器脚本在这里，但在头部，我有这一部分在这里。我声明dataLayer，然后我将继续把菜单样式和geo推到dataLayer。再一次，我在head标签中做这个，在我的谷歌标签管理器运行之前。好的，让我们看看这是什么样子。这里我要打开预览模式，这样我们就可以得到调试屏幕，回到这里，重载这个页面，你可以看到在左边这里，我们有不同的事件被推送到数据层。

你不想再次声明它，在你已经这样做了之后，这是不好的。第二个问题是，当您向数据层添加更多的项时，您将再次使用相同的初始化脚本，然后将以前的数据层吹走，然后用一个新的数据层替换它。这里我们有我们第一次初始化它,我们把menu-style放在这里,然后这些点这些椭圆代表更多的代码,然后以后我们说,嘿,想添加菜单后面,所以我们做的是相同的代码,会发生什么我们重新定义它,失去之前我们所做的一切。

这很容易做到，因为你只是在剪切和粘贴，但是就像我说的，调试起来会很困难，而且会导致重大问题。所以，我喜欢做的更好的方法是在页面顶部声明dataLayer一次。如果你想变得更花哨，你甚至可以检查它是否已经在你做之前已经声明了。但是，我们不会做得太深入，只要你只做一次，大多数人认为这是可以管理的。之后,你会填满数据使用这个推函数,在这种情况下,我有一些其他的代码,然后回来,我将更多的项目没有问题,因为我不是重新声明,我只是促使更多的项目现有的数据层。

我已经做了这个例子，让我们进入界面，看一下。你看这里，我有我的标签管理器脚本在这里，但在头部，我有这一部分在这里。我声明dataLayer，然后我将继续把菜单样式和geo推到dataLayer。再一次，我在head标签中做这个，在我的谷歌标签管理器运行之前。好的，让我们看看这是什么样子。这里我要打开预览模式，这样我们就可以得到调试屏幕，回到这里，重载这个页面，你可以看到在左边这里，我们有不同的事件被推送到数据层。

###Data-layer variables and Google Analytics integration

好的，这就是我们把所有东西联系在一起的部分。我们要把数据推送到数据层，把它放到gtm中，把它存储为一个变量，把它应用到我们的一个标签上，然后验证标签是否被触发，数据是否被正确发送。如果我已经完成了我的工作，它不仅会很快，而且会相对简单地跟随我们，看看我们已经走了多远。在上个视频中，我们确定了我们想要的网站为我们提供的菜单是服务于访问者和菜单的。让我们先抓取其中一个然后把它保存为一个标签管理器变量。

回到这里，我们看到我们要把dataLayer推到这里，menu-style和menu-geo。让我们抓取菜单样式，从源文件中复制。记住，如果没有的话，我可以一直在这里变成黄蜂。我可以看到这里也叫菜单样式。我们在调试面板中。我们可以到数据层来看看它也叫菜单样式。所以我们有很多选项来提醒我们数据层上有什么。接下来要做的是创建一个变量来保存它。所以我要进入这里，进入变量，我要做一个新的变量类型。

这里我们要获取一个数据层变量。我们可以称之为我们想要的。当然，保持一致是有意义的。这里也是一样。我们说数据层变量名。我们把它当作菜单式，所以我们准备好了。我通常会在这里保留这个版本2除非你使用嵌套的值。我们还设置了一个默认值，我确实喜欢这样做，特别是如果我把它发送回谷歌分析，因为其他的自定义维度不会捕获空的数据，所以我喜欢说notset，这样至少我们会有一些默认值。

我们创建这个变量，它要做的就是把它从数据层中取出来填充它作为谷歌标签管理器变量。好的，我们现在已经有了这个变量，我们需要把它添加到标签中。但是在我们想要把那个标签发送回来之前，我想要把它作为谷歌分析的一部分发送，作为自定义维度返回。我想把这些数据作为攻击的一部分发送回来。所以我需要进入谷歌分析我要设置那个自定义维度。所以我们来到自定义维度，创建一个新的自定义维度，我将调用这个菜单样式。

我把它设为一个会话级变量。这样我只需要把它发送回去一次，它就会回复到整个会话。所以继续，创建它。这是自定义维度1。所以当我回到谷歌标签管理器时，我要去到我的标签。我要看看这个基本标签。这是我们在每个页面视图中将数据发送回谷歌分析的地方。再一次，我可以改变这个触发器，让它成为我想要的，但是基本标签应该在每一个页面上。接下来我要做的是在这里输入更多的设置，自定义维度。我要添加一个自定义维度。

我们说指数是1。我要做的就是点击我的小乐高，向下滚动。菜单样式是我们有的，就是这样。我点击保存标记。现在我想要确保在发布之前先预览一下。回来，刷新我的页面。

我们看到UA基地标签被发射了。我要进入WASP因为它会显示自定义维度。在这里输入WASP，重载页面然后我们会看到这里的基本标签。所以我得到谷歌分析，发送收集脚本，当然，它是，自定义维度1,2015年春季。这就是它。在不到四分钟的时间里，我们有了一个例子，我们使用了容器、标签、触发器、变量和数据层。如果你跟随这里的每一件事，你就会成功。

但这并不意味着没有更多的东西可以学习。看看下一部电影，我们将通过一些后续步骤和一些领域继续学习。

###Next steps

希望现在您已经开始使用谷歌标记管理器运行了。我们已经讨论了很多问题，但是如果你有兴趣了解更多的话，还有很多东西需要深入研究。我们希望我们在简化和展示这个神奇的免费工具的力量和深度之间取得了正确的平衡。但是我很乐意听到你的反馈，所以不要羞于让我们知道你想知道的更多，或者直接在Twitter上联系我。至于学习更多的地方，当然对于那些用这个来实现谷歌分析的人来说，我知道你们很多人都是，我是《生活要点》和《技巧与技巧课程》的作者，这是一个更高级的课程。

很多谷歌的标签管理器都是关于JavaScript的，关于lynda的JavaScript课程也是非常有用的，就像正则表达式的内容一样。特别是在谷歌标记管理器资源上，我建议从谷歌+的谷歌标签管理组开始。这确实是一个令人惊奇的社区，他们不仅推动了信封的边缘，而且他们非常愿意分享他们的知识。它没有一个简洁的URL，但是谷歌+搜索谷歌标签管理器会让你得到这个。非常感谢你的加入，我希望能尽快收到你的来信。
有句话说：所有的输入都是有害的

这几天研究网站恶意请求知识，看了一篇文章说，懂得网络安全，才知道黑客的一些行为。在此简单总结下几种，
写作是弱点，就得弥补，最近在得到上听《好战略，坏战略》电子书
东一棒槌，西一棒槌

写文章花了一周时间，每周输出一篇文章

战战兢兢，如履薄冰的去听需求，证明很害怕。

杜绝长篇大论的谈论或者搬运文字，抓取重点来理解和阐述。

写此篇思想和心得：

在现有的基础上，坚持做一件事，进行升华，很有成就感，以后需要增加更多的乐趣。

看了好多文章，有些讲得比较抽象，比较笼统，现在自己总结对此的理解，并且一步步解密网络安全的面纱，总结不对的请更正

## CSRF恶意请求

代码

webA：安全信任网站
webB：攻击者网站 （带有恶意请求）
userA：安全操作者
userB：攻击者

CSRF概念：跨站点请求伪造(Cross—Site Request Forgery)，


一、CSRF的攻击原理及实现过程：
1. userA访问webA网站，登录账号和密码，验证信息通过，webA的服务器把生成的cookie返给浏览器，并保存下来，这样可以正常发请求给webA；
2. 用户未退出webA之前，在同一浏览器中，打开一个TAB页访问webB；
3. webB接收到用户请求后，返回一些攻击性代码，并发出一个请求要求访问第三方站点A；

诱导点击的方式
- 通过放入广告诱导用户点击webB，
- 邮件
- 短信

骗取userA访问恶意网页webB

攻击性代码形式：
- url，比如 http://bank.example/withdraw?account=userA&amount=1000000&for=userB  此url可以通过请求把userA的1000000元转给userB
- <img src=""/>

请求行为：
- 通过cookie转账
- 模仿用户提交表单行为
- 删除帖子（比如url中带有id，就能删除帖子）
<img alt="" arc="http://localhost/list.php?action=delete&id=12"/>
这个利用了img的src可以跨域请求的特点，这种情况比较少，因为`一般网站不会利用get请求修改资源信息`。

get一般是获取信息，不会用来修改资源。

举最简单的例子
```
恶意网站这么写一样可以攻击：
<!DOCTYPE html>
<html>
　　<body>
　　　　<iframe display="none">
　　　　　　<form method="post" action="http://localhost/list.php">
　　　　　　　　<input type="hidden" name="action" value="delete">
　　　　　　　　<input type="hidden" name="id" value="12">
             <input id="csfr" type="submit"/>
　　　　　　</form>
　　　　</iframe>

        <script type="text/javascript">
      　　　　 document.getElementById('csfr').submit();
　　　　</script>
　　</body>
</html>
```

二、 实例场景：

三、 防御手段：
目前防御手段主要有三种：验证http referer字段、在请求头中添加token并验证、在http中自定义属性并验证

**验证http referer字段**


**在请求头中添加token并验证**
换句话说，也就是对请求进行认证，加上token验证，证明是安全用户本来发起的

验证码（通过手机或者邮箱，得到验证码，可以证明是本人，不是第三方伪造的）


**在http中自定义属性并验证**

**跨域**

**采用post请求**
post可以增加攻击的难度，请求更安全，需要用js实现，

参考链接：
https://blog.csdn.net/qq_29999249/article/details/65627893?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522159123433119725247630164%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=159123433119725247630164&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~baidu_landing_v2~default-4-65627893.first_rank_ecpm_v3_pc_rank_v2&utm_term=csrf+%E5%89%8D%E7%AB%AF

https://www.jianshu.com/p/a5ff8a23b423


## XSS 跨站点脚本攻击

Http Header攻击

url中重定向到地址，比如微信授权登录就有这种操作，（跟第三方打通，基本上有这些操作。）
被重定向的地址中包含script等恶意代码，可以编码或者过滤。

- 添加恶意代码：在请求头的cookie中加入内容，可能会超过8k，所以限制请求头大小（限制request headers的大小）

把超过8k的header链接发给受害者,就会被服务器拒绝访问。解决办法就是检查cookie的大小,限制新cookie的总大写，减少因header过大而产生的拒绝访问攻击


危害形式：
- 网络钓鱼，包括窃取用户账号；
- 窃取用户cookies资料，从而获得用户隐私信息，或利用用户身份进一步对网站执行操作；
- 劫持用户会话，进行非法转账、强制发表日志、发送电子邮件等；
- 强制弹出广告、刷流量等；
- 恶意操作，删除文章等；
- 网页挂马；
- 传播跨站脚本蠕虫等

**反射型XSS**
通过输入url，将恶意脚本附加到url上，通常出现在网站的搜索栏和用户登录的地方。
http://weibo.com/login.php?'u=1931138954'<script>alert(/ssss/)</script>

XSS 跨框架钓鱼
怎么构造钓鱼？使用标签iframe.
http://weibo.com/login.php?'u=1931138954'<iframe src='http://www.baidu.com'/>  

此种url别人可能会问，一眼就看出来不合法的链接，攻击者会对url进行编码


怎么盗取到cookie的呢

现在大部分主流浏览器已经对url攻击做了预防方法。

登录银行的页面，把iframe框覆盖页面的登录框，这样可以获取到账号和密码，


HTML注入式钓鱼
直接利用XSS漏洞注射HTML/JavaScript代码到页面中，或者是把用户输入的数据”存储“在服务器端。
```
比如输入：
<script>alert('包小姐')</script>
<script>alert(document.cookie)</script>
```

现在浏览器和后端都设置了安全机制。

常见的解决办法：
- XSS Filter，分析用户提交的输入，并消除潜在的跨站脚本攻击、恶意的HTML等。在需要html输入的地方对html标签及一些特殊字符( ” < > & 等等 )做过滤，将其转化为不被浏览器解释执行的字符。

- 如果检测到不合法的输入字符，返回404或者405（访问被阻断）


**持久型**
概念：攻击者想方设法把恶意代码上传或者存储到服务器中。

攻击方式：
- 通常出现在博客日志、留言、评论等

- 实现蠕虫行为：将xss shellcode写进xss点（例如个人档案），引诱用户查看，攻击者利用ajax修改受害用户的个人档案信息(怎么修改？post请求改个人档案)，将恶意的代码复制进去。随后任何查看受害者个人档案的也会被感染，执行重复操作，直到xss蠕虫传播。

xss蠕虫: 利用ajax/js 编写的蠕虫病毒，能够在网站中实现病毒的几何数级传播，其感染速度和攻击效果都很可怕

- 绕过xss Filter：
1）利用<>标记注射HTML/js
解决：过滤和转义<>或<script>等字符，从而过滤某些形式的xss<script>shellcode</script>
2）利用HTML标签属性值执行xss
<table background="javascript:alert(/xss/)"></table>
![](javascript:alert('xss');)
解决：过滤JavaScript等关键字

3）


```
比如输入：
<script>alert('包小姐')</script>
<script>alert(document.cookie)</script>
```

https://www.jianshu.com/p/a5ff8a23b423?111%3Cscript%3Ealert(/ssss/)%3C/script%3E
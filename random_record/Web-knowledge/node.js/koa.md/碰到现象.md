

## 多个中间件会形成一个栈结构（middle stack），以"先进后出"（first-in-last-out）的顺序执行。
1. 最外层的中间件首先执行。
2. 调用next函数，把执行权交给下一个中间件。
3. ...
4. 最内层的中间件最后执行。
5. 执行结束后，把执行权交回上一层的中间件。
6. ...
7. 最外层的中间件收回执行权之后，执行next函数后面的代码。

举例：

这有异步操作（比如读取数据），中间件就必须写成 async 函数。

这样中间件执行顺序不会按“先进后出”顺序执行
```
const fs = require('fs');
const fsp = require('fs.promised');

const hotM = async function (ctx, next) {
  console.log('hotM1');
  next();
  console.log('hotM2');
};

const main = async function (ctx, next) {
  console.log('main1');
  ctx.response.type = 'html';
    // ctx.response.body = fs.readFile('./client/index.html');
  // fs.readFile('./client/index.html','utf8', (err,data)=>{
  //   if(err){
  //     console.log('main err'+err);
    
  //   }else{
  //     console.log('main2');
  //     data1 = data;

  //   }
  // });
  <!--ctx.response.body = fs.createReadStream('./index.html');//同步-->  
  // ctx.response.body = await fsp.readFile('./index.html', 'utf8');  //加上它会先执行hotM2，再执行main2
  next();
  console.log('main2');
};

如果是异步读取顺序是：
hotM1
main1
hotM2
main2

如果是同步读取顺序是：
hotM1
main1
main2
hotM2
```


(node:8033) [DEP0013] DeprecationWarning: Calling an asynchronous function without callback is deprecated.


## Module build failed: SyntaxError: Unexpected token
```
include: [
    path.join(__dirname, 'client'),
    path.join(__dirname, "client","scripts")
],
options: {
    presets: ['react','es2015']
},
```
webpack.config中需要加入'react';include中需要加入对应文件位置

## WARNING in asset size limit: The following asset(s) exceed the recommended size limit (250 kB).This can impact web performance.

webpack 配置中加入：

{
  performance: {
    hints: dev ? false : 'warning'
  }
}


"build": "webpack --config ./webpack.config.js --progress --profile --colors"
运行build，会出现Version、Hash、Time

```
867ms building modules
0ms advanced chunk modules optimization 
0ms after chunk modules optimization 
0ms module reviving                 
1ms module order optimization                       
0ms advanced module order optimization 
0ms before module ids 
1ms module ids 
0ms module id optimization 
1ms chunk reviving                 
1ms chunk order optimization                       
1ms before chunk ids 
1ms chunk id optimization                          
0ms after chunk id optimization 
1ms record modules                 
2ms record chunks                 
5ms hashing 
0ms after hashing                            
0ms record hash 
1ms module assets processing 
26ms chunk assets processing
1ms additional chunk assets processing                            
1ms recording                            
0ms additional asset processing 
51ms chunk asset optimization               
1ms after chunk asset optimization 
0ms asset optimization 
0ms after asset optimization 
1ms after seal 
58ms emitting
Hash: 3917256dddfa26e313bc
Version: webpack 4.7.0
Time: 1123ms
Built at: 05/06/2018 7:40:01 PM
   Asset     Size  Chunks                    Chunk Names
index.js  304 KiB       0  [emitted]  [big]  index
Entrypoint index = index.js
[17] ./client/index.js 2.63 KiB {0} [built]
     factory:67ms building:656ms = 723ms
    + 17 hidden modules
```
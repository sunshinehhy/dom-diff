**2018.04.02**

请求2次，第一次请求更新锁；第二次请求更新订阅界面；post支付信息

执行先后顺序：paywall是否会按照先后顺序执行

完成任务：
1. 陪帆总解决ios问题
2. 完成webapp锁更新和订阅页面调试
3. 编辑精选页面研究

todo：
1. 放开story页面
2. 与强哥调试订单号
3. 做q&a

**2018.04.03**
1. cookie实现：
请求的时候把cookie值放入页面，如果付费，存入cookie，没付费不打开。跟true和false一样

任务：
1. 登录登出分别写上逻辑
2. 要不要强制刷新，不强制刷新的话又一次请求
3. 会员中心，假如没有登录不显示
4. 本地测试

getAjaxDataObj = Object.assign({}, parsedData);

**2018.04.05**
"Privileges"

每个设备的category不一样
track：
1. story页：点击哪篇文章，文章包含中文和英文，对照，要分别记录
2. 点击立即订阅，需要记录
3. 点击立即订阅需要记录
4. 点击支付成功需要记录（这个是在后台）
5. 选择支付形式记录
6. 支付哪个产品需要记录
7. 打开付费页面和付费story页面需要记录
8. 点击编辑精选需要记录

安卓端
1. 点击支付成功与否我这边可以记录


支付成功得直接跳到story页面，失败就不跳了；
那得获取支付的
第一次请求paywall，更新锁，但是支付成功，得更新缓存值，并且重新刷新页面；

如果第一个订阅了，第二个还是变成想现在升级；假如是第一个支付成功，就不升级


问题：
1. 把story id传入进入订阅动作那，获取id，成功后paywall再调用readStory()；
这个界面其实仅仅有一个订阅过了，就可以查看
2. 每日英语的双语阅读和原声视频可以看
3. 只能看每周
4. 每日英语的$item.type == "premium"为1么

**2018.04.06**
只能读取一周文字思路：获取这篇文章的pubtime时间，向前加上一周的时间（这周时间也变成时间戳），如果超过这个时间，点击会搜索出一系列文章，然后把这些文章加上time

搜索出的文章也是在nexthome.html中，
搜索出来的文章，通过timeStamp来添加锁

添加：
  || ($smarty.now-$sc.timeStamp>=604800) 
$smarty.now好像有问题，查下

教育：
http://www.ftchinese.com/channel/education.html
http://api001.ftimg.net/androidapp.html#/channel//index.php/ft/channel/phonetemplate.html?channel=education

订阅页面当支付成功时，页面变化情况：
1. 当支付第一个id时，支付成功后，立马更新第二个
2. 支付成功弹到story页面，把当前订阅页面关闭，当支付成功的时候变成none；当失败的时候和进入订阅窗口的时候变成block
3. 支付成功立马更新整个页面
更新的地方包括：
 - 隐藏订阅页面
 - 更新锁
 - story页面可以见


 {% include "QandA.html" %}

 <%assign var="p" value=$nextmodel->getPublishJson('home')|json_decode:true%>

登出之后会出现paywall，会有一次

// 测试window.onload 好像不能去除，这是为什么

reload好像不更新锁，锁停留在最初始的状态。reload不执行paywall，除非清楚缓存，第一次执行paywall

如果订阅成功，重新刷新会执行paywall，我觉得可执行先删除缓存，再添加缓存

登录成功会执行paywall，交易成功为什么不会执行？
reload好像就看不到sucess的consloe

刷新一下，不执行paywall，因为记录了什么呢？

刷新后，要刷新，运行readStory();

update cmstmp01.userinfo set isvip=0 where user_id='9270d53f-ac4b-4184-afae-42cacce12193'; 

update premium.ftc_vip set vip_type=0,expire_time=0 where vip_id='9270d53f-ac4b-4184-afae-42cacce12193';

**2018.04.10**
汇报：
1. 做了q&a界面效果，但还没上线
2. 修复了每日英语的bug
3. 上线pc端的独家和编辑精选；安卓还没完成
4. 添加付费相关ga跟踪


加入id和channel后面的值
怎么加入：把它变成一个函数，然后传入一个变量
在哪里点击，添加一个

// var paywallHintHtml = '<div class="subscribe-lock-container"><div class="lock-block"><div class="lock-content">成为付费会员，阅读FT独家内容</div><div class="lock-content">如果已经是会员，请<a href="http://user.ftchinese.com/login">点击这里</a>登录</div><div class="subscribe-btn iap-channel" iap-action="membership" iap-title="会员"><span style="color:white">成为会员&#x25BA;</span></div></div></div>';

// var downloadHintHtml = '<div class="subscribe-lock-container"><div class="lock-block"><div class="lock-content">使用FT中文网 iOS应用</div><div class="lock-content">成为付费会员，阅读FT独家内容</div><div class="subscribe-btn"><span><a href="http://a.app.qq.com/o/simple.jsp?pkgname=com.ft#" target="_blank" style="color:white">下载应用&#x25BA;︎</a></span></div></div></div>';

        <img src="<%$pt.image%>" class=leftimage width="167">
        <div class="headline wide-screen"><%$pt.headline%></div>
        <div class=lead><%$pt.longlead|default:$pt.shortlead%></div>
        <div class=clearfloat></div>

                  "113":{
                      "id":"113",
                      "reid":"1",
                      "code":"exclusive",
                      "name":"独家",
                      "type":"link",
                      "link":"/channel/exclusive.html",
                      "haschildren":"0",
                      "children":[

                      ]
                  },
                  "112": {
                        "id": "112",
                        "reid": "1",
                        "code": "editorchoice",
                        "name": "编辑精选",
                        "type": "channel",
                        "link": "/channel/editorchoice.html",
                        "haschildren": "0",
                        "children": []
                  },
    
要搜集什么信息？
如何将其他数据传递到代码？
收集的信息，应该把代码注入到它网站中，这样tag-manager才能获取到他们的信息。
获取头像应该把获取头像的代码注入gtm

在什么设备上使用容器

cookies是延后获取到的

ga('send','event','web member subscribe','toPay',productID + ' ' + actionType);

**2018.04.12**

**删除cookie重新刷新出现内容**
应该是先从后台请求来的数据，然后缓存下来；
点击进来是调用

明天任务：
1. 研究gam，明天早点来
2. 继续调试安卓


'+'getBuyCode()'+'

buyCode = ' onclick="getBuyCode(\''+ productId +'\',\''+ priceForAndroid +'\',\''+ userId +'\',\''+ productName +'\')"';

/**
 * 订阅界面动作
 */

// $('body').on('click', '.openPayment', function(){
//     if (ftjavacriptapp){
//         ftjavacriptapp.payzfb('FT0109831523596303','0.01','9270d53f-ac4b-4184-afae-42cacce12193','标准会员')
//     }else{

//     }  
// });


注释了paymentPage.innerHTML = '';
这个有待考核是否有用？

**2018.04.17**
明天任务：
1. 添加订阅页面
2. 调整锁的bug

**2018.04.18**
登录和登出，因为
更新锁，如果付费，出现锁
paywall.js是每个文件都引用了

编辑精选点进去不会执行

pc端编辑精选：
paywall，用url来区分编辑精选，假如url是它，

**2018.04.19**
因为仅仅请求一次，执行一次；所以不会

2个逻辑：最后面全部替换成一个页面？
最好还是替换了；返回给productid；怎么才能知道哪个付费了呢？根据处理后id和属性来进行比较
怎么获取到这id，哪个被点击哪个被赋值，支付成功刷新页面，就会执行post动作

支付完成最后面还是不变；选择微信或者支付宝支付。

**2018.04.20**
任务：调试webapp
想怎么加入微信支付入口
想速读怎么跟踪
仅仅需要编辑精选返回地方需要变成true，其它都是false
返回按钮，是编辑story，如果持续返回还是有以前的问题；可以添加一个特殊的class

锁没更新，我觉得是第一次默认都是有锁，然后请求不到

怎么考虑选择微信支付还是支付宝支付，肯定是在订阅那选择，选择支付宝后确定支付调用那个函数.
main.js是读了首页的，没有读这个页面的，因为首页已经变化了，所以一直为0，怎么让它不

todo:
1. 支付那些对象，可以传到一个对象中；然后分别选择进行支付。把选中的值存入一个变量中再传入界面中。下周做
2. 试译宝跟踪
3. ga跟踪

做的修改：快速阅读
href="http://www.ftacademy.cn/subscription.html" 

**2018.04.23**
一上午时间研究gtm，完成一件事，结束一件事
1. 跟踪页面
2. 跟踪event
怎么获取特定的label来区分不同的event，是需要跟代码连续起来还是直接在gtm中获取

你们好，我们是使用google tag manage跟踪数据，为了跟踪到更全面的信息，需要获取你们代码中的一些变量甚至是代码，这样根据代码情况设置不同的label能跟踪到不同的event，才能对应上不同的事件(比如点击我要参战，需要获取我要参战按钮的id或者其他属性————只要能定位是它触发的变量都行)，这样才能跟踪到监控使用效果。你们使用过google tag manage吗？

目前我能想到具体跟踪的event有 
- 我要参战（label可以用参战时间）
- 继续战斗（可以监测到兴趣度）
- 战果分析（可以监测学习兴趣）
- 喊人参战（监测分享情况）


具体运营定位和期待，我还得从运营此产品同事得知。

ga('send','event','web translate battle', eventAction, EventLabel);

我觉得eventAction或者EventLabel最好能跟踪到用户，这样可以对每个用户行为进行分析。

event中可以添加入人名，怎么获取人名呢？给他传变量

因为我不知道您那边代码怎么实现的，我们可以约定一些值（比如提交动作的id或者其他属性）吗？或者你能提供给我们一些变量？

进入参战的页面，战果分析的页面，
page view中需要有人名


todo：回去新建项目，开始着手接触新东西
**2018.04.24**

1. 编辑精选弹出一个提示页面，提示页面是全屏吗？
2. 扫码微信支付弹出一个页面。（也用支付成功页面）
3. 如果付过费，再点击不顶用；我应该在点击那再请求一次（这思路再想想）
4. 

**2018.04.25**

保存了代码在2018.04

**2018.04.26**
思路：请求出来的数据，获取一个对象，如果点击，在后面插入；但是前台用什么条件判断

登录登出现象：
1. 第一次能登出，但获取的第一次登出user_id为空，第二次登录能获取到
2. 只能登录一次，第二次登出不能成功
20180326


成功与否页面
思路：添加失败原因、产品类型、notice文字

汇报内容：
1. 安卓端速读点击不进去bug
2. 登出不能清除缓存bug
3. 添加编辑精选和速读订阅提示入口
4. 订阅页面当订阅成功屏蔽再次进入付费页面
5. 其它一些更新
6. 做支付成功与否弹出页面

